<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Aztec Wall</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <meta name="theme-color" content="#121528" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%236f6ce8"/><rect x="18" y="18" width="28" height="28" rx="6" fill="%23ffffff"/></svg>' />
</head>
<body>
     <div class="wrap">
    <h1>Aztec Wall</h1>
    <p class="lead">Submit your X handle. Join Aztec Family Wall</p>

    <form id="form" class="controls" autocomplete="off">
      <input id="handle" type="text" inputmode="text" placeholder="@handle" />
      <button id="submitBtn" type="submit">Submit</button>
    </form>
    <div id="msg" class="msg"></div>

  
    <div class="stage">
      <section id="wall" aria-live="polite"></section>
    </div>
  </div>

  <a class="credit" href="https://x.com/seuncoded" target="_blank" rel="noopener">Built by @seuncoded</a>

  <audio id="bgMusic"
       src="/audio/aztec-theme.mp3"
       preload="auto"
       loop
       muted
       playsinline></audio>


<button id="musicToggle" style="
  position: fixed;
  bottom: 16px;
  right: 16px;
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: var(--shadow);
">
  ðŸ”Š Play Music
</button>
  <script src="app.js" defer></script>
</body>
<script>
  const music = document.getElementById('bgMusic');
  const toggle = document.getElementById('musicToggle');
  const PREF_KEY = 'aztec_wall_music';

  // restore preference
  const pref = localStorage.getItem(PREF_KEY); // 'on' | 'off' | null
  music.volume = 0.35;

  // Try autoplay muted (allowed by browsers)
  (async () => {
    try { await music.play(); } catch {}
    // If user previously chose ON, wait for a gesture then unmute
    if (pref === 'on') armFirstGestureToUnmute();
    updateButton();
  })();

  function armFirstGestureToUnmute(){
    const onceUnmute = async () => {
      try {
        music.muted = false;
        await music.play();
        updateButton();
      } catch {}
      removeGestureListeners();
    };
    document.addEventListener('click', onceUnmute, { once:true, passive:true });
    document.addEventListener('touchstart', onceUnmute, { once:true, passive:true });
    document.addEventListener('keydown', onceUnmute, { once:true });
  }
  function removeGestureListeners(){
    document.removeEventListener('click', armFirstGestureToUnmute);
    document.removeEventListener('touchstart', armFirstGestureToUnmute);
    document.removeEventListener('keydown', armFirstGestureToUnmute);
  }

  function updateButton(){
    toggle.textContent = music.muted || music.paused ? 'ðŸ”Š Play Music' : 'ðŸ”‡ Mute Music';
  }

  // Button behavior: toggle mute and remember choice
  toggle.addEventListener('click', async () => {
    if (music.paused) {
      try { await music.play(); } catch {}
    }
    music.muted = !music.muted;
    localStorage.setItem(PREF_KEY, music.muted ? 'off' : 'on');
    updateButton();
  });

  // On first user interaction, if no pref set, unmute once
  if (!pref) armFirstGestureToUnmute();

  // iOS quirks: keep playing when tab visible, pause when hidden
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) { music.pause(); }
    else { music.play().catch(()=>{}); }
  });
</script>
</html>